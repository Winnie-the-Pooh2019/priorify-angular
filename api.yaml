openapi: "3.0.0"
info:
  version: "1.0"
  title: "Priorify - OpenAPI 3.0"
  description: 
    –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞
servers:
  - url: http://localhost:8000/api/v1
tags:
  - name: auth üîí
    description: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
  - name: users üë§
    description: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
  - name: collections üóÇÔ∏è
    description: –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö
  - name: analyzes üîé
    description: –í—ã—è–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º
  - name: finances üí∞
    description: –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤

paths:

  /auth/login:
    post:
      tags:
        - auth üîí
      summary: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
      operationId: authLogin
      requestBody: 
        description: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        content: 
          application/json:
            schema:
              $ref: '#/components/schemas/LoginCredentials'
      responses:
        '200':
          description: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthToken'

  /auth/logout:
    post:
      tags:
        - auth üîí
      summary: –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
      operationId: authLogout
      responses:
        '200':
          description: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ –≤—ã—à–µ–ª –∏–∑ —Å–∏—Å—Ç–µ–º—ã
      security:
        - bearedHttpAuthentification: []

  /auth/refresh:
    post:
      tags:
        - auth üîí
      summary: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
      operationId: authRefresh 
      requestBody:
        description: –¢–æ–∫–µ–Ω –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshToken'
      responses:
        '200':
          description: –¢–æ–∫–µ–Ω
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AccessToken'

  /auth/me:
    get:
      tags:
        - auth üîí
      summary: –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
      operationId: authMe
      responses:
        '200':
          description: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
      security:
        - bearedHttpAuthentification: []
            
  /users:
    post:
      tags:
        - users üë§
      summary: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
      operationId: users
      requestBody:
        description: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterUser'
      responses:
        '200':
          description: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserCreate'
      security:
        - bearedHttpAuthentification: []

  /collections:
    post:
      tags:
        - collections üóÇÔ∏è
      summary: –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Å–æ—Ü—Å–µ—Ç–µ–π
      operationId: postCollections
      requestBody:
        description: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–±–æ—Ä–∞
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateDataCollection'
      responses:
        '201':
          description: –ó–∞–ø—Ä–æ—Å –Ω–∞ —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω
          content:
            application/json:
              schema: 
                $ref: '#/components/schemas/DataCollectionPreview'
      security:
        - bearedHttpAuthentification: []
    get:
      tags:
        - collections üóÇÔ∏è
      summary: –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–π –¥–∞–Ω–Ω—ã—Ö
      operationId: getCollections
      responses:
        '200':
          description: –£—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ
          content:
            application/json:
              schema: 
                type: array
                items:
                  $ref: '#/components/schemas/DataCollectionPreview'

  /collections/{collectionId}:
    parameters:
      - name: collectionId
        in: path
        required: true
        schema:
          type: integer
          example: 1
    get:
      tags:
        - collections üóÇÔ∏è
      summary: –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
      responses:
        '200': 
          description: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω–∞
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DataCollectionFull'
      security:
        - bearedHttpAuthentification: []
    delete:
      tags:
        - collections üóÇÔ∏è
      summary: –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
      responses:
        '204':
          description: –ö–æ–ª–ª–µ–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞

  /analyzes:
    post:
      tags:
        - analyzes üîé
      summary: –°–æ–∑–¥–∞–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–±–ª–µ–º
      requestBody:
        content:
          application/json:
            schema: 
              $ref: '#/components/schemas/CreateAnalysis'




components:
  schemas:
    RegisterUser:
      type: object
      properties:
        firstName:
          type: string
          example: –ê–ª–µ–∫—Å–∞–Ω–¥—Ä
        lastName:
          type: string
          example: –ò–≤–∞–Ω–æ–≤
        email:
          type: string
          example: alexander@email.com
        password:
          type: string
          example: qwerty123
        role:
          type: string
          default: analyst
          enum:
            - analyst
    UserCreate:
      type: object
      properties:
        id:
          type: integer
          example: 1
        firstName:
          type: string
          example: –ê–ª–µ–∫—Å–∞–Ω–¥—Ä
        lastName:
          type: string
          example: –ò–≤–∞–Ω–æ–≤
        email:
          type: string
          example: alexander@email.com
        password:
          type: string
          example: qwerty123
        role:
          type: string
          default: analyst
          enum:
            - analyst
            - admin
    UserResponse:
      type: object
      properties:
        id:
          type: integer
          example: 1
        firstName:
          type: string
          example: –ê–ª–µ–∫—Å–∞–Ω–¥—Ä
        lastName:
          type: string
          example: –ò–≤–∞–Ω–æ–≤
        email:
          type: string
          example: alexander@email.com
        role:
          type: string
          default: analyst
          enum:
            - analyst
            - admin
    LoginCredentials:
      type: object
      properties:
        email:
          type: string
          example: alexander@email.com
        password:
          type: string
          example: qwerty123
    AuthToken:
      type: object
      properties:
        accessToken:
          type: string
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWUsImlhdCI6MTUxNjIzOTAyMn0.KMUFsIDTnFmyG3nMiGM6H9FNFUROf3wh7SmqJp-QV30"
        refreshToken:
          type: string
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWUsImlhdCI6MTUxNjIzOTAyMn0.KMUFsIDTnFmyG3nMiGM6H9FNFUROf3wh7SmqJp-QV30"
        expiresIn:
          type: integer
          example: 900
    RefreshToken:
      type: object
      properties:
        refreshToken:
          type: string
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWUsImlhdCI6MTUxNjIzOTAyMn0.KMUFsIDTnFmyG3nMiGM6H9FNFUROf3wh7SmqJp-QV30"
    AccessToken:
      type: object
      properties:
        accessToken:
          type: string
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWUsImlhdCI6MTUxNjIzOTAyMn0.KMUFsIDTnFmyG3nMiGM6H9FNFUROf3wh7SmqJp-QV30"

    CreateDataCollection:
      type: object
      required:
        - name
        - startDate
        - endDate
        - sources
      properties:
        name:
          type: string
          example: –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –ø–æ –ö–µ–º–µ—Ä–æ–≤–æ
        startDate:
          type: string
          format: date
          example: 2002-02-20
        endDate:
          type: string
          format: date
          example: 2025-02-20
        sources:
          type: array
          items:
            type: object
            properties:
              socialNetwork:
                type: string
                enum:
                  - vk
                  - telegram
              externalId:
                type: string
                example: incident_kuzbass
    DataCollectionPreview: 
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –ø–æ –ö–µ–º–µ—Ä–æ–≤–æ
        startDate:
          type: string
          format: date
          example: 2002-02-20
        endDate:
          type: string
          format: date
          example: 2025-02-20
        sources:
          type: array
          items:
            type: object
            properties:
              social_network:
                type: string
                enum:
                  - vk
                  - telegram
              external_id:
                type: string
                example: incident_kuzbass
        createdAt:
          type: string
          format: date
        startedAt:
          type: string
          format: date-time
        finishedAt:
          type: string
          format: date-time
        status:
          type: string
          enum:
            - pending
            - progress
            - completed
            - failed
            - canceled
        totalPublications:
          type: integer
          example: 12000
          nullable: true
          description: –û–±—â–µ–µ —á–∏—Å–ª–æ —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö –ø—É–±–ª–∏–∫–∞—Ü–∏–π. –î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö —Å–±–æ—Ä–æ–≤.
        successfulRequestsPercent:
          type: number
          format: float
          nullable: true
          description: –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤. –î–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö —Å–±–æ—Ä–æ–≤.
    DataCollectionFull: 
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –ø–æ –ö–µ–º–µ—Ä–æ–≤–æ
        startDate:
          type: string
          format: date
          example: 2002-02-20
        endDate:
          type: string
          format: date
          example: 2025-02-20
        sources:
          type: array
          items:
            type: object
            properties:
              social_network:
                type: string
                enum:
                  - vk
                  - telegram
              external_id:
                type: string
                example: incident_kuzbass
              status:
                type: string
                enum:
                - pending
                - progress
                - completed
                - failed
                - canceled
              startedAt:
                type: string
                format: date-time
              finishedAt:
                type: string
                format: date-time
              totalPublications:
                type: integer
                example: 6000
                nullable: true
        createdAt:
          type: string
          format: date
        startedAt:
          type: string
          format: date-time
        finishedAt:
          type: string
          format: date-time
        status:
          type: string
          enum:
            - pending
            - progress
            - completed
            - failed
            - canceled
        totalPublications:
          type: integer
          example: 12000
          nullable: true
          description: –û–±—â–µ–µ —á–∏—Å–ª–æ —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö –ø—É–±–ª–∏–∫–∞—Ü–∏–π. –î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö —Å–±–æ—Ä–æ–≤.
        successfulRequestsPercent:
          type: number
          format: float
          nullable: true
          description: –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤. –î–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö —Å–±–æ—Ä–æ–≤.
    CreateAnalysis:
      properties:
        name: 
          type: string
          example: –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º –ø–æ –ö–µ–º–µ—Ä–æ–≤–æ
        collectionId:
          type: integer
          example: 1
        analysisType:
          type: string
          example: manual
          enum:
            - manual
            - budgetClassifier
            - auto
        topics:
          type: array
          items:
            type: string
            example: –∑–¥—Ä–∞–≤–æ–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
          example: ["–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞", "—ç–∫–æ–ª–æ–≥–∏—è", "–∑–¥—Ä–∞–≤–æ–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ"]
        topicCount:
          type: integer
          example: 10
      discriminator:
        propertyName: analysisType
        mapping:
          manual: '#/components/schemas/ManualAnalysis'
    ManualAnalysis:
      allOf:
        - $ref: '#/components/schemas/CreateAnalysis'
        - type: object
          required:
            - topics


  securitySchemes:
    bearedHttpAuthentification:
      description: Bearer token using a JWT
      type: http
      scheme: bearer
      bearerFormat: JWT